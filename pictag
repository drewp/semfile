#!/usr/bin/python

"""
stores tags for files


todo:

upgrade tag input to foaf:person, us city, wordnet word, etc.

see also:

http://www.kanzaki.com/test/exif2rdf

"""

import os, sys, urllib, time
from rdflib import Graph, URIRef, Namespace, RDF, Literal
from rdflib.util import date_time
from semfile import read_or_create_graph, graph_filename, FOAF, TAG, DC


graph = read_or_create_graph(graph_filename)

imgfile_uri = URIRef("file://%s" % os.path.abspath(sys.argv[1]))


img_statement = (imgfile_uri, RDF.type, FOAF['Image'])
if graph.triples(img_statement):
    graph.add(img_statement)
    graph.add((imgfile_uri,
               DC['issued'],
               Literal(date_time(local_time_zone=True))))

for tag in sys.argv[2:]:
    tag_uri = URIRef(TAG[urllib.quote_plus(tag)])
    graph.add((imgfile_uri, FOAF['topic'], tag_uri))

graph.save(graph_filename)

